var dataType=[];var columnType=[];var columnName=[];var rowsValue=new Array();var tablestr="";var accountName=[];var accountId=[];var profileId=[];var propName;var profName;var loc;var chartData=[];var tbl_id,endDate,startDate;var dimension;var metrics;var data;var queryString;var filter;var segment;var sort;var maxResults;var dataTable;var flag;var profileName;var div_id;var node;google.load("visualization","1",{packages:["corechart","table"]});$(function(){$("#emailId").hide();$("#sendEmail").hide();$("#showQuery").hide();console.log("list profile");$.ajax({type:"POST",url:"/getuserlist",contentType:"application/json"}).done(function(f){console.log(f);localStorage.removeItem("userlist");if(f!=""&&f!=undefined&&f!=null){appendtoprofilelist(f)}else{$("#profilelists").notify("No Profile Found","info",{position:"bottom"})}}).fail(function(f){console.log("error"+f)});$("#email").click(function(){$("#emailId").show();$("#sendEmail").show()});$("#sendEmail").click(function(){if(/^\w+([\.-]?\w+)@\w+([\.-]?\w+)(\.\w{2,3})+$/.test($("#emailId").val())){console.log("Email ready to send");console.log(queryString);if(queryString!=null){queryString.emailId=$("#emailId").val();console.log(queryString);console.log(typeof queryString);$.ajax({type:"POST",url:"/emailRequest",contentType:"application/json",dataType:"json",data:JSON.stringify(queryString)}).done(function(f){console.log(f.status);alert(f.status);$("#emailId").hide();$("#sendEmail").hide()})}else{alert("Attachment Data is empty")}}else{alert("e-mail address not valid format")}});console.log(!localStorage.getItem("AccountDetails"));if(!localStorage.getItem("AccountDetails")){$.ajax({type:"GET",url:"/getAccountInfo",contentType:"application/json"}).done(function(f){console.log("Msessage"+f);console.log(typeof f);localStorage.setItem("AccountDetails",f);c(f)})}else{var e=localStorage.getItem("AccountDetails");c(e)}function c(i){if(!i){$("#accountName").append("<option value='0'>No account found</option>")}else{var h=jQuery.parseJSON(i);console.log(h);var g=[];g=h;console.log(g);$("#accountName").empty();$("#propName").empty();$("#tabl").empty();var j=" <option value=0>Select AccountName</option>";for(var f in g){j+="<option value='"+f+"'>"+g[f]+"</option>"}$("#accountName").append(j)}}$("#accountName").change(function(){$("body").css("cursor","wait");console.log("opertion property"+$("#accountName option:selected").val());var f={};var g=$("#accountName option:selected").val();f.accountid=g;console.log(typeof f+f);var h=[];$("#propName").empty();console.log(!localStorage.getItem(g));if(!localStorage.getItem(g)){console.log("from server");$.ajax({type:"POST",url:"/getPropertyInfo",dataType:"json",data:JSON.stringify(f),contentType:"application/json"}).done(function(k){console.log(k);var j=JSON.stringify(k);localStorage.setItem(g,j);a(j)})}else{var i=localStorage.getItem(g);a(i)}});function a(h){$("body").css("cursor","default");console.log(JSON.parse(h));var i=JSON.parse(h);console.log(i);properties=i;var f="<option value=0>Select Properties</option>";for(var g in properties){f+="<option value='"+g+"'>"+properties[g]+"</option>";console.log(g)}$("#propName").append(f)}$("#propName").change(function(){$("body").css("cursor","wait");console.log("opertion property"+$("#accountName option:selected").val());console.log("opertion property"+$("#propName option:selected").val());var f={AccountId:$("#accountName option:selected").val(),PropertiesID:$("#propName option:selected").val()};f=JSON.stringify(f);console.log(f);$("#profName").empty();var g=[];console.log(!localStorage.getItem(f));if(!localStorage.getItem(f)){$.ajax({type:"POST",url:"/getProfileInfo",dataType:"json",contentType:"application/json",data:f}).done(function(i){var h=JSON.stringify(i);localStorage.setItem(f,h);b(h)})}else{console.log(localStorage.getItem(f));b(localStorage.getItem(f))}});function b(f){$("body").css("cursor","default");console.log(f);var i=JSON.parse(f);console.log(i);profileInfo=i;var h="<option value=0>Select ProfileName</option>";for(var g in profileInfo){h+="<option value='"+g+"'>"+profileInfo[g]+"</option>"}$("#profName").append(h)}$("#profName").change(function(){$("#tabl").val("ga:"+$("#profName option:selected").val())});$(".datepicker").datepicker({dateFormat:"yy-mm-dd",maxDate:"+0D"});$("#saveprofile").click(function d(){console.log("porfile saved");flag=1;profileName=prompt("Please Enter the profile name","");if(JSON.parse(localStorage.getItem("userlist"))){var f=JSON.parse(localStorage.getItem("userlist"));for(var g in f){if(f[g].profileName==profileName){console.log("key details "+g+""+f[g].profileName);$("#saveprofile").notify("Profile Name already there",{position:"top"});d()}else{}}}if(profileName!=""&&profileName!=null){$("#saveprofile").notify("Profile will be save on next request","info",{position:"bottom"})}console.log(profileName)});$("#getdata").click(function(){$("body").css("cursor","wait");var f=new Date();tbl_id=$("#tabl").val();dimension=$("#dimension_val").val();metrics=$("#metric_value").val();segment=$("#segment").val();filter=$("#filter").val();sort=$("#sort").val();startDate=$("#startdate").val();endDate=$("#enddate").val();maxResults=$("#maxResults").val();console.log(metrics.lastIndexOf(","));console.log(metrics.length-1);if(metrics.lastIndexOf(",")==metrics.length-1){metrics=metrics.substring(0,metrics.length-1);console.log(metrics)}if(dimension.lastIndexOf(",")==dimension.length-1){dimension=dimension.substring(0,dimension.length-1);console.log(dimension)}queryString=new Object();queryString.queryId=tbl_id;queryString.metrics=metrics;queryString.dimensions=dimension;queryString.startDate=startDate;queryString.endDate=endDate;queryString.filter=filter;queryString.segment=segment;queryString.sort=sort;queryString.maxResults=maxResults;if(profileName!=""&&profileName!=null){queryString.profileName=profileName}profileName="";console.log(queryString);localStorage.setItem($("#emailInfo").text().trim()+","+f.getTime(),JSON.stringify(queryString));if($("#startdate").val()==""||$("#tabl").val()==""||$("#metric_value").val()==""||$("#enddate").val()==""){alert("Please Enter (*) Required feild  value")}else{console.log(dimension.substring(0,3));if(dimension.substring(0,3)=="ga:"||metrics.substring(0,3)=="ga:"||filter.substring(0,3)=="ga:"||sort.substring(0,3)=="ga:"){if(dimension.split(",").length<8||dimension.split(",").length<8){$.ajax({type:"POST",url:"/getdataAjax",dataType:"json",async:true,contentType:"application/json",data:JSON.stringify(queryString)}).done(function(j){displaychart(j);if(queryString.profileName!=undefined){var k=new Object();var g=new Object();var i=0;if(localStorage.getItem("userlist")!=null){k=JSON.parse(localStorage.getItem("userlist"));for(var h in k){i++}k[queryString.profileName]=queryString}console.log("size vale:"+i);g[i]=queryString;console.log("user obj "+g);appendtoprofilelist(JSON.stringify(g))}}).fail(function(i){$("#totalcountrep").text("");var g;console.log(i);$("body").css("cursor","default");console.log(i.responseText);if(i.responseText.substring(0,3)=="400"){console.log(typeof i.responseText);g=JSON.stringify(i.responseText);console.log(g);g=('"'+g.substring(g.indexOf("{")));console.log(g+typeof g);var h=JSON.parse(g);console.log(h+typeof h);var j=JSON.parse(h);console.log(j);$("#tablechart").html("Error:  "+j.message)}else{if(i.responseText.substring(0,3)=="401"){$("#tablechart").html("Your Credentials expired Please Login <a href='/googleLogin'>Click Here</a>")}else{$("#tablechart").html("Error:  "+i.responseText)}}})}else{$("#tablechart").html("Error: you requested "+dimension.split(",").length+" dimensions and "+metrics.split(",").length+" metrics. Maximum 7 dimensions, 7 metrics are allowed")}}else{alert("The field start with ga:")}}});$("#showQuery").click(function(){$("#formvalues").show();$("#userProfile").show();$("#showQuery").hide()});$("#lastresult").click(function(){alert("hi you want last search results");$.ajax({type:"GET",url:"/getlastsearch",dataType:"json",contentType:"application/json",data:"emailId="+$("#emailInfo").text().trim()}).done(function(f){displaychart(f)}).fail(function(f){console.log(f);console.log("responsetext"+f.responseText);if(f.responseText==""){$("#lastresult").notify("no last result found","info",{position:"left"})}})});$("#download").click(function(){if(!(typeof dataTable)){csvDownload(JSON.parse(JSON.stringify(dataTable)),"Report")}else{alert("No data found for csv download")}});$("input[type=radio]").click(function(){alert("hi");console.log("hi radio")})});function appendtoprofilelist(g){var f=JSON.parse(g);var h=[];var b=0;var a;console.log("append default value"+g);console.log("userlistvalue"+localStorage.getItem("userlist"));if(localStorage.getItem("userlist")!=null){a=localStorage.getItem("userlist");a=a.substring(0,a.length-1);console.log("temp valeu"+a);localStorage.setItem("userlist",a.concat(","+g.substring(1)));console.log("data value"+g.substring(1))}else{localStorage.setItem("userlist",g)}console.log(f);for(var d in f){h[b++]=d}console.log("key value"+h);for(var e=0,c;(c=h[e]);++e){console.log(c);$("<div id="+c+'><input type="radio" name="userProfile" id="usrProf" value="'+c+'"><label>'+JSON.parse(localStorage.getItem("userlist"))[c].profileName+"</label>&nbsp;&nbsp;</div>").prependTo($("#getuserprofile"))}$("input:radio").unbind("click");$("input:radio").bind("click",function(){console.log("hi radio");console.log("radio button");var j;console.log("The ID is: "+div_id);if(div_id){document.getElementById(div_id).removeChild(node)}console.log($(this).attr("value"));node=document.createElement("input");node.setAttribute("type","button");node.setAttribute("value","Apply");node.setAttribute("id","getvalue");div_id=$(this).attr("value");console.log("div id"+div_id);var i=JSON.parse((localStorage.getItem("userlist")));for(var k in i){if(k==$("input:radio:checked").val()){console.log(i[k]);j=k;console.log(div_id);$.notify("Query: "+JSON.stringify(i[k]),"info")}}document.getElementById(div_id).appendChild(node);$("#getvalue").click(function(){var l=i[j];console.log(l);console.log("table"+l.queryId);$("#tabl").val(l.queryId);$("#dimension_val").val(l.dimensions);$("#metric_value").val(l.metrics);$("#filter").val(l.filter);$("#startdate").val(l.startDate);$("#enddate").val(l.endDate)})})}function displaychart(o){console.log(o);console.log(typeof o);var t=o;dataTable=new google.visualization.DataTable;console.log(t.rows);if(typeof t.rows=="undefined"){dataTable.addColumn("string","none");dataTable.addRows(1);dataTable.setCell(0,0,"no results found");$("#totalcountrep").text(" ")}else{dataTable.addColumn("number","Index");for(var s=0,h;h=t.columnHeaders[s];++s){dataTable.addColumn("DIMENSION"==h.columnType?"string":"number",h.name);console.log("i value "+s+"j avalue "+h)}console.log(dataTable.getNumberOfColumns());dataTable.addRows(t.rows.length);for(var g=0,f;f=t.rows[g];++g){dataTable.setCell(g,0,g+1);for(var e=0,d;d=f[e];++e){var c=t.columnHeaders[e];var b=d;console.log(b+"m value"+e+"k:value"+g);var a=c.dataType;if("INTEGER"==a){b=parseInt(d,10)}else{if("CURRENCY"==a){b=parseFloat(d)}else{if("PERCENT"==a||"TIME"==a||"FLOAT"==a){b=Math.round(100*b)/100}}}dataTable.setCell(g,e+1,b)}}$("#totalcountrep").text("total no. of results "+t.totalResults)}console.log(dataTable);console.log(JSON.stringify(dataTable));console.log(JSON.parse(JSON.stringify(dataTable)));$("#formvalues").hide();$("#userProfile").hide();$("#showQuery").show();$("body").css("cursor","default");display(dataTable)}function csvDownload(i,j){var p=typeof i!="object"?JSON.parse(i):i;var s="";s+=j+"\r\n\n";for(var r=0,q;q=p.cols[r];++r){s+=q.label+","}s+="\r\n";for(var n=0,m;m=p.rows[n];++n){for(var l=0,k;k=m.c[l];++l){s+=k.v+","}s+="\r\n"}var h=j;var g="data:text/csv;charset=utf-8,"+escape(s);var o=document.createElement("a");o.href=g;o.style="visibility:hidden";o.download=h+".csv";document.body.appendChild(o);o.click();document.body.removeChild(o)}function display(b){var a=new google.visualization.Table(document.getElementById("tablechart"));a.draw(b,null)};